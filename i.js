function iJS(t=null){window.ijs?t&&window.ijs.ConfInit(t):setTimeout(()=>{iJS(t)},1)}function Ijs(){window.state={},this.textContentReg=/{([\s\S]*?)}/gm,this.numberReg=/\.([0-9]*?)\./gm,this.classPathReg=/{{([\s\S]*?)}}/gm,this.paramsReg=/\(([\s\S][^(]*?)\)/gm,this.maksParamsReg=/\((.*)\)/gm,this.maksKeysReg=/\[(.*)\]/gm,this.funcReg=/^([\s\S]*?)\(/gm,this.apis={objects:[],keys:{}},this.events=[],this.classes=[],this.events=[],this.data=[],this.keys={},this.paths={},this.helps={data:[],keys:{},helpKeys:{},objects:[]},this.models=new Ijs_Object,this.updateTimer=null,this.modelTimer=null,this.updateIds={},this.updateConditionIds={},this.updateIfIds={},this.updateApiIds={},this.tmp={},this.LocalDataInit({loading:{}}),this.models.add({model:!0,id:"$page"}),this.models.add({model:{},id:"$event"}),this.Run();for(let t=0;t<document.querySelectorAll("loading").length;t++)document.querySelectorAll("loading")[t].remove()}function Ijs_Array(){this.items=[]}function Ijs_Object(){this.items={},this.functions={},this.watch={}}function ObjectAssign(t,e){for(let i in e)"__data"!=i&&(null===t&&(t={}),Array.isArray(e[i])?(t[i]=[],e[i].forEach(e=>{t[i].push(ObjectAssign({},e))})):null!==e[i]&&"object"==typeof e[i]&&"object"==typeof t[i]?t[i]=ObjectAssign(t[i],e[i]):null!==e[i]&&"object"==typeof e[i]?t[i]=ObjectAssign({},e[i]):t[i]=e[i]);return t}function Ijs_API(api,self){let paramValue;for(this.self=self,this.active=!0,this.timerId=null,this.sendTimerId=null,this.dataPathReg=/{{([\s\S]*?)}}/gm,this.url=api.url,this.method=api.method,this.action=api.action,this.model=api.model,this.node=api.node,this.id=api.id,this.localStorage=api.localStorage,this.load=!1,this.parent_id=api.parent_id,this.credentials=api.credentials,this.pref=api.path,this.success_callback=null,this.error_callback=null,this.jsonData=api.data;null!=(paramValue=this.dataPathReg.exec(api.data));){let t=this.self.RePref({data:paramValue[1],pref:this.pref,state:1});this.jsonData=this.jsonData.replace(paramValue[0],t),paramValue[1]=paramValue[1].replace("state.",""),this.self.apis.keys[paramValue[1]]||(this.self.apis.keys[paramValue[1]]=[]),-1===this.self.apis.keys[paramValue[1]].indexOf(this.id)&&this.self.apis.keys[paramValue[1]].push(this.id)}"READ"===this.action&&setTimeout(()=>{let json;if(eval(`json = ${this.jsonData};`),this.data=json,this.localStorage){const t=JSON.parse(localStorage.getItem(this.id)?localStorage.getItem(this.id):"null");t&&setTimeout(()=>{Ijs_API_dataInit({model:t,id:this.id})},0)}"READ"===this.action&&this.init()},0)}function Ijs_API_dataInit({model:t,id:e}){window.ijs.models.add({model:t,id:e,clean:!0}),window.state[e]=window.ijs.models.items[e][e],window.ijs.ModelInit(e)}async function jspi(t){return new Promise(function(e,s){this.url=t.url,this.data=t.data,this.method=t.method?t.method:"GET";let a=new XMLHttpRequest;if("GET"!==this.method)a.open(this.method,this.url);else{let t="";for(i in this.data)t=`${t=t?`${t}&`:t}${i}=${encodeURI(this.data[i])}`;a.open(this.method,`${this.url}?${t}`)}t.dataType&&"html"==t.dataType||(a.responseType=t.dataType?t.dataType:"json"),this.credentials&&(a.withCredentials=!0),a.send(JSON.stringify(this.data)),a.onload=function(){e(a.response)},a.onerror=function(){s({status:a.status,response:a.response})},a.onprogress=function(t){}})}function aapi(t,e=null,s=null,a=null){this.url=t.url,this.data=t.data,this.method=t.method?t.method:"GET",this.credentials=!!t.credentials&&t.credentials;let n=new XMLHttpRequest;if("POST"==this.method)n.open(this.method,this.url);else{let t="";for(i in this.data)t=`${t=t?`${t}&`:t}${i}=${encodeURI(this.data[i])}`;n.open(this.method,`${t?`${this.url}?${t}`:this.url}`)}if(t.dataType&&"html"==t.dataType||(n.responseType=t.dataType?t.dataType:"json"),this.credentials&&(n.withCredentials=!0),"POST"!==this.method)n.send(JSON.stringify(this.data));else{var o=new FormData;for(var d in this.data)o.append(d,this.data[d]);n.send(o)}n.onload=function(){200===n.status?e&&e(n.response,a):s&&s(n.status,n.response,a)},n.onerror=function(){s&&s(n.status,n.response,a)},n.onprogress=function(t){}}function CleanDataInit(t){if("object"==typeof t){if(Array.isArray(t)){let e=[];for(const i in t)"__data"!==i&&(e[i]=CleanDataInit(t[i]));return e}if(null!=t){let e={};for(const i in t)"__data"!==i&&(e[i]=CleanDataInit(t[i]));return e}return t}return t}function getArrayHandler(t){return{get:function(t,e){return"isProxy"==e||t[e]},set:function(e,i,s,a){if("length"==i)window.ijs.UpdateState(`${t}.${i}`),window.ijs.UpdateState(t);else if("object"==typeof s){const a=Object.keys(s);for(key in s=InitData(s,`${t}.${i}`),e[i]=s,a)window.ijs.UpdateState(`${t}.${i}.${a[key]}`)}else e[i]=s,window.ijs.UpdateState(`${t}.${i}`);return!0}}}function InitData(t,e=""){const i=t;t={__data:{}},Object.defineProperty(t,"__data",{enumerable:!1});const s=Object.keys(i);for(k in s){const a=s[k];if(t.__data[a]=i[a],function(i){Object.defineProperty(t,i,{enumerable:!0,get:function(){return t.__data[i]},set:function(s){Array.isArray(t.__data[i])?t.__data[i]=new Proxy(s,getArrayHandler(e?`${e}.${i}`:i)):t.__data[i]=s,window.ijs.UpdateState(e?`${e}.${i}`:i)}})}(a),Array.isArray(i[a])){for(let t in i[a])"object"==typeof i[a][t]&&(i[a][t]=InitData(i[a][t],e?`${e}.${a}.${t}`:`${a}.${t}`));t.__length=i[a].length,t.__data[a]=new Proxy(i[a],getArrayHandler(e?`${e}.${a}`:a))}else"object"==typeof i[a]&&i[a]&&(t.__data[a]=InitData(t.__data[a],e?`${e}.${a}`:a))}return t}function IjsInputDom(t,e){this.obj="input",this.redata=0,this.path=t.path?t.path:"",this.node=t.node,this.model=t.model,this.models=[this.model],this.mask=t.mask?t.mask:null,this.data=t.data?t.data:null,this.input=t.input?t.input:null,this.parent_id=t.parent_id?t.parent_id:null,this.id=t.id,this.timerId=null,this.self=e,this.focus=!1,this.Change=this.Change.bind(this),this.Radio=this.Radio.bind(this),this.Checked=this.Checked.bind(this);let i=this.node.getAttribute("type");i&&(i=i.trim().toLowerCase()),"SELECT"===this.node.tagName?(this.attr="value",this.node.addEventListener("change",this.Change),this.node.value=this.self.GetData({name:this.data,pref:this.path})):"TEXTAREA"===this.node.tagName?(this.attr="value",this.node.addEventListener("keyup",this.Change),this.node.addEventListener("focus",()=>{this.focus=!0}),this.node.addEventListener("focusout",()=>{this.focus=!1}),this.node.value=this.self.GetData({name:this.data,pref:this.path})):"checkbox"==i?(this.attr="checked",this.node.addEventListener("change",this.Checked),this.node.checked=IsJsonString(this.self.GetData({name:this.data,pref:this.path}))?JSON.parse(this.self.GetData({name:this.data,pref:this.path})):!!this.self.GetData({name:this.data,pref:this.path})):"radio"==i?(this.attr="radio",this.node.addEventListener("change",this.Radio),this.node.value==this.self.GetData({name:this.data,pref:this.path})&&(this.node.checked=!0)):(this.attr="value",this.node.addEventListener("keyup",this.Change),this.node.addEventListener("focus",()=>{this.focus=!0}),this.node.addEventListener("focusout",()=>{this.focus=!1}),this.node.value=this.self.GetData({name:this.data,pref:this.path}))}function IjsClassDom(t){this.data=t.data,this.parent_id=t.parent_id,this.node=t.node,this.timerId=null,this.ReClass()}function IjsForDom(t,e){this.data=null,this.model=t.model?t.model:"",this.path=t.path?t.path:"",this.node=t.node?t.node:null,this.id=t.id?t.id:null,this.pref=t.pref?t.pref:null,this.index=t.index?t.index:0,this.three_id=t.three_id?t.three_id:null,this.parent_id=t.parent_id?t.parent_id:null,this.self=e,this.textContentReg=/{([\s\S]*?)}/gm,this.paramsReg=/\(([\s\S]*?)\)/gm,this.maksParamsReg=/\((.*)\)/gm,this.maksContentReg=/{(.*)}/gm,this.funcReg=/^([\s\S]*?)\(/gm,this.helpNode=document.createElement("DIV"),this.nodes=[];for(let t=0;t<this.node.children.length;t++)this.nodes.push(this.node.children[t].cloneNode(!0));let i;for(this.node.innerHTML="",this.data=this.node.getAttribute("items");null!=(i=this.maksContentReg.exec(this.data));)this.data=i[1];this.model||(this.model=this.data.trim().split(".")[0]),this.models=this.self.GetModels({pref:this.path,data:this.data}),this.newPath=this.self.RePref({data:this.data,pref:this.path}),this.ReInit()}function IjsEventDom(t,e){this.model=t.model,this.node=t.node,this.attr=t.attr,this.nodeName=t.attr.nodeName,this.path=t.path,this.pref=t.pref?t.pref:null,this.index=t.index?t.index:null,this.three_id=t.three_id?t.three_id:null,this.parent_id=t.parent_id?t.parent_id:null,this.self=e,this.funcReg=/^([\s\S]*?)\(/gm,this.AddEvent()}function IjsPageDom(t,e){this.model=t.model,this.node=t.node,this.tagName=t.node.tagName,this.path=t.path,this.id=t.id?t.id:null,this.pref=t.pref?t.pref:null,this.index=t.index?t.index:null,this.three_id=t.three_id?t.three_id:null,this.parent_id=t.parent_id?t.parent_id:null,this.self=e,this.helpNode=document.createElement("DIV"),this.waiter=0}function IjsIfDom(t,e){this.model=t.model,this.path=t.path,this.id=t.id?t.id:null,this.pref=t.pref?t.pref:null,this.index=t.index?t.index:null,this.three_id=t.three_id?t.three_id:null,this.parent_id=t.parent_id?t.parent_id:null,this.self=e,this.textContentReg=/{([\s\S]*?)}/gm,this.paramsReg=/\(([\s\S]*?)\)/gm,this.nodes=[],this.helpNode=document.createElement("DIV");let i=t.node,s=0;for(;i;){const t=this.InitNode(i,s);s++,this.nodes.push(t),i="ELSE"!==i.tagName?this.NextNode(i):null}this.ReInit()}function getRandomArbitrary(t,e){return Math.random()*(e-t)+t}function idInit(t){return`${t.pref}${t.nodeName[0]}${t.three_id}${t.index}${t.i}`}function GetParamsFromString(t){let e=0,i=[],s=0;for(let a=0;a<t.length;a++)","===t[a]&&0==e?(i.push(t.substring(s,a).trim()),s=a+1):"("===t[a]?e++:")"===t[a]&&e--;return s!=t.length&&i.push(t.substr(s,t.length).trim()),i}function IsJsonString(t){try{JSON.parse(t)}catch(t){return!1}return!0}function object_join(t,e){let i=Object.assign({},t);return Object.assign(i,e)}document.addEventListener("DOMContentLoaded",function(){window.ijs=new Ijs}),Ijs.prototype.ConfInit=function(t){t.methods&&this.models.addFunctions(t.methods),t.watch&&this.models.addWatch(t.watch),window.state.$f=this.models.functions,t.data&&this.LocalDataInit(t.data),this.ModelInit("*"),this.models.functions.onload&&(this.models.functions.onload(),this.models.functions.onload=null)},Ijs.prototype.Run=function(){this.PageAnalyze(),this.AddCatchHref();let t=this;window.onpopstate=function(e){aapi({url:document.location,dataType:"html"},e=>{let i=(new DOMParser).parseFromString(e,"text/html").querySelector("page");i&&t.GetPageNode().rePage(i)})}},Ijs.prototype.PageAnalyze=function(){this.DocumentAnalyze()},Ijs.prototype.LocalDataUpdate=function(t){this.models.add({model:t,id:"$"}),window.state.$=this.models.items.$.$},Ijs.prototype.LocalDataInit=function(t){this.LocalDataUpdate(t),this.ModelInit("$")},Ijs.prototype.api=function(t){return this.apis.objects.find(e=>e.id==t)},Ijs.prototype.ApiInit=function(t){const e=t.node,i={url:e.getAttribute("url")?e.getAttribute("url"):null,method:e.getAttribute("method")?e.getAttribute("method"):"GET",action:e.getAttribute("action")?e.getAttribute("action").toUpperCase():"READ",data:e.getAttribute("data")?e.getAttribute("data"):"{}",model:e.getAttribute("model")?e.getAttribute("model"):null,id:e.getAttribute("id")?e.getAttribute("id"):e.getAttribute("model")?e.getAttribute("model"):null,credentials:!!e.hasAttribute("credentials"),localStorage:!!e.hasAttribute("localStorage"),parent_id:t.parent_id,path:t.path,node:e},s=this.AnalyzeAttribute(object_join(t,{id:i.id,attr:{nodeName:"url",nodeValue:e.getAttribute("url")},i:0}),!0);if(s&&(i.url=s),this.api(i.id))return this.api(i.id).active=!0,this.api(i.id).node=e,void this.api(i.id).reConf(i);let a={};a[i.id]=!1,this.LocalDataUpdate({loading:a});const n=new Ijs_API(i,this);this.apis.objects.push(n)},Ijs.prototype.GetPageNode=function(){return this.helps.objects.find(t=>"PAGE"===t.tagName)},Ijs.prototype.AddCatchHref=function(){document.addEventListener("click",t=>{if(t.metaKey||t.ctrlKey)return;const e=t.target.closest("a");if(e&&(!e.getAttribute("target")||"_blank"!=e.getAttribute("target"))&&e.getAttribute("href")&&!e.hasAttribute("reopen")&&this.GetPageNode()){const i=e.getAttribute("href");i!=location.pathname&&this.page(i,t),t.preventDefault()}})},Ijs.prototype.page=function(t,e=!1){this.GetPageNode()||(location=t),window.ijs.SetData("$page",!1),aapi({url:t,dataType:"html"},e=>{let i=(new DOMParser).parseFromString(e,"text/html").querySelector("page");i?(window.scrollTo(0,0),this.GetPageNode().rePage(i),window.history.pushState({},"",t)):location=t,window.ijs.SetData("$page",!0)},()=>{location=t})},Ijs.prototype.DocumentAnalyze=function(){this.NodeAnalyze({node:document.querySelectorAll("body")[0],path:"",model:"",pref:0,index:0,three_id:0,parent_id:""})},Ijs.prototype.NodeAnalyze=function(t){"MODEL"===t.node.tagName&&(t.path=`${t.path}${t.node.getAttribute("path")}.`),"MODEL"!==t.node.tagName||t.model||(t.model=t.node.getAttribute("path").split(".")[0]),"API"===t.node.tagName?this.ApiInit(t):"IF"===t.node.tagName?this.IfNode(t):"FOR"===t.node.tagName?this.ForNode(t):"PAGE"===t.node.tagName?this.PagePlaceInit(t):"ELSEIF"===t.node.tagName||"ELSE"===t.node.tagName||"STYLE"===t.node.tagName||"DATA"===t.node.tagName||"SCRIPT"===t.node.tagName||"CODE"===t.node.tagName||"NOINDEX"===t.node.tagName||("INPUT"===t.node.tagName||"TEXTAREA"===t.node.tagName?this.InputNode(t):"SELECT"===t.node.tagName?(this.ForNode(t),this.InputNode(t)):this.ClassicNode(t))},Ijs.prototype.PagePlaceInit=function(t){const e=new IjsPageDom({node:t.node,path:t.path,model:t.model,pref:t.pref,index:t.index,three_id:t.three_id,id:idInit(object_join(t,{nodeName:t.node.tagName,i:0})),parent_id:t.parent_id},this);this.AddHelpNode(e),this.ClassicNode(object_join(t,{parent_id:e.id,pref:t.pref+t.index,index:0,three_id:t.three_id+1}))},Ijs.prototype.AddClass=function(t){let e,i=t.attr.nodeValue;for(;null!=(e=this.classPathReg.exec(t.attr.nodeValue));)i=i.replace(e[0],this.RePref({data:e[1],pref:t.path}));for(t.attr.nodeValue=i;null!=(e=this.numberReg.exec(t.attr.nodeValue));)i=i.replace(e[0],`[${e[1]}].`);const s=new IjsClassDom({data:i=i.split("$f").join("state.$f").split(".*").join(""),parent_id:t.parent_id,node:t.node});this.classes.push(s)},Ijs.prototype.ReClass=function(){this.classes.forEach(t=>{t.ReClass()})},Ijs.prototype.AnalyzeAttribute=function(t,e=!1){if("click"===t.attr.nodeName||"thisclick"===t.attr.nodeName||"hover"===t.attr.nodeName||"keyup"===t.attr.nodeName||"change"===t.attr.nodeName||"focus"===t.attr.nodeName||"blur"===t.attr.nodeName||"enter"===t.attr.nodeName)return void this.events.push(new IjsEventDom(t,this));if(":class"===t.attr.nodeName)return void this.AddClass(t);let i,s=!1,a=t.attr.nodeValue;for(;null!=(i=this.textContentReg.exec(t.attr.nodeValue));){const n=t.model?t.model:i[1].trim().split(".")[0],o=this.GetModels({pref:t.path,data:i[1]});let d=i[1].trim();const h={node:t.node,path:t.path,model:n,models:o,data:d,mask:i[0],input:i.input,attr:t.attr.nodeName,id:e&&t.id?t.id:idInit(object_join(t,{nodeName:t.attr.nodeName})),parent_id:t.parent_id};this.AddNode(h,e),s=!0,a=a.replace(h.mask,this.GetData({name:h.data,pref:h.path}))}return s&&"textContent"!==t.attr.nodeName?t.node.setAttribute(t.attr.nodeName,a):s&&(t.node.textContent="",t.node.innerHTML=a),a||null},Ijs.prototype.ForNode=function(t){for(let e=0;e<t.node.attributes.length;e++)if("items"!==t.node.attributes[e].nodeName);else if("items"===t.node.attributes[e].nodeName){const i=new IjsForDom({node:t.node,path:t.path,model:t.model,pref:t.pref,index:t.index,three_id:t.three_id,id:idInit(object_join(t,{nodeName:t.node.tagName,i:e})),parent_id:t.parent_id},this);i.data&&this.AddHelpNode(i)}},Ijs.prototype.IfNode=function(t){for(let e=0;e<t.node.attributes.length;e++)if("condition"!==t.node.attributes[e].nodeName)this.AnalyzeAttribute(object_join(t,{attr:t.node.attributes[e],i:e}));else if("condition"===t.node.attributes[e].nodeName){const i=new IjsIfDom({node:t.node,path:t.path,model:t.model,pref:t.pref,index:t.index,three_id:t.three_id,id:idInit(object_join(t,{nodeName:t.node.tagName,i:e})),parent_id:t.parent_id},this);this.AddHelpNode(i)}},Ijs.prototype.InputNode=function(t){t.node.getAttribute("value")&&t.node.getAttribute("type")&&"radio"==t.node.getAttribute("type").toLowerCase()&&this.AnalyzeAttribute(object_join(t,{attr:{nodeName:"value",nodeValue:t.node.getAttribute("value")},i:28}));for(let e=0;e<t.node.attributes.length;e++)if("name"===t.node.attributes[e].nodeName){let i,s;for(;null!=(s=this.textContentReg.exec(t.node.attributes[e].nodeValue));)i=s;if(i){const s=t.model?t.model:i[1].trim().split(".")[0];let a=i[1].trim();if(i[1].trim()){const n=new IjsInputDom({node:t.node,model:s,path:t.path,mask:i[0],input:i.input,data:a,id:idInit(object_join(t,{nodeName:"value",i:e})),parent_id:t.parent_id},this);this.AddNode(n)}}}else"setfocus"==t.node.attributes[e].nodeName?setTimeout(()=>{t.node.focus()},10):"value"!==t.node.attributes[e].nodeName&&this.AnalyzeAttribute(object_join(t,{attr:t.node.attributes[e],i:e}));if(0!==t.node.children.length)for(let e=0;e<t.node.children.length;e++)this.NodeAnalyze(object_join(t,{node:t.node.children[e],pref:t.pref+t.index,index:e,three_id:t.three_id+1}))},Ijs.prototype.ClassicNode=function(t){for(let e=0;e<t.node.attributes.length;e++)this.AnalyzeAttribute(object_join(t,{attr:t.node.attributes[e],i:e}));if(0===t.node.children.length)this.AnalyzeAttribute(object_join(t,{attr:{nodeValue:t.node.textContent,nodeName:"textContent"},i:0}));else for(let e=0;e<t.node.children.length;e++)this.NodeAnalyze(object_join(t,{node:t.node.children[e],pref:`${t.pref}${t.index}`,index:e,three_id:t.three_id+1}))},Ijs.prototype.AddNode=function(t,e=!1){this.data.push(t),this.ParseKeys({data:t.data,pref:t.path,log:"input"==t.obj}).forEach(i=>{"state"==(i=i.split("."))[0]&&(i=i.slice(1)),i=i.join("."),this.keys[i]||(this.keys[i]=[]),-1===this.keys[i].indexOf(t.id)&&this.keys[i].push(t.id),e&&(this.apis.keys[i]||(this.apis.keys[i]=[]),-1===this.apis.keys[i].indexOf(t.id)&&this.apis.keys[i].push(t.id))})},Ijs.prototype.AddIfCondition=function(t){this.helps.data.push(t),this.ParseKeys({data:t.data,pref:t.path,state:!0}).forEach(e=>{"state"==(e=e.split("."))[0]&&(e=e.slice(1)),e=e.join("."),this.helps.keys[e]||(this.helps.keys[e]=[]),-1===this.helps.keys[e].indexOf(t.id)&&this.helps.keys[e].push(t.id),this.helps.helpKeys[e]||(this.helps.helpKeys[e]=[]),-1===this.helps.helpKeys[e].indexOf(t.ifId)&&this.helps.helpKeys[e].push(t.ifId)})},Ijs.prototype.AddHelpNode=function(t){if(this.helps.objects.push(t),t.data){this.ParseKeys({data:t.data,pref:t.path,state:!0}).forEach(e=>{this.helps.helpKeys[e]||(this.helps.helpKeys[e]=[]),-1===this.helps.helpKeys[e].indexOf(t.id)&&this.helps.helpKeys[e].push(t.id)})}},Ijs.prototype.UpdateState=function(t){this.keys[t]&&this.keys[t].forEach(t=>this.updateIds[t]=1),this.helps.keys[t]&&this.helps.keys[t].forEach(t=>this.updateConditionIds[t]=1),this.helps.helpKeys[t]&&this.helps.helpKeys[t].forEach(t=>this.updateIfIds[t]=1),this.apis.keys[t]&&this.apis.keys[t].forEach(t=>this.updateApiIds[t]=1),this.paths[`watch.${t}`]=1,clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>{this.tmp={},this.ChangeInit(),this.updateIds={},this.updateConditionIds={},this.updateIfIds={},this.updateApiIds={},this.paths={}},0)},Ijs.prototype.ChangeInit=function(){Object.keys(this.updateApiIds).forEach(t=>this.api(t).reData());let t=!0;for(;t;){const e=Object.keys(this.updateConditionIds),i=Object.keys(this.updateIfIds);this.DataInit(e,this.helps.data),t=this.HelpInit(i,this.helps.objects)}const e=Object.keys(this.updateIds);this.DataInit(e,this.data),this.ReClass();const i=Object.keys(this.paths);setTimeout(()=>{this.WatchInit(i)},1)},Ijs.prototype.ModelInit=function(t){this.tmp={};let e=!0;for(;e;){const i=this.GetUniqueIds(t,this.helps.data,"id"),s=this.GetUniqueIds(t,this.helps.data,"ifId"),a=this.GetUniqueIds(t,this.helps.objects,"id");this.DataInit(i,this.helps.data),e=this.HelpInit(s,this.helps.objects),this.HelpInit(a,this.helps.objects)&&(e=!0)}const i=this.GetUniqueIds(t,this.data,"id");this.DataInit(i,this.data),this.ReClass()},Ijs.prototype.GetUniqueIds=function(t,e,i){const s=e.filter(e=>"*"===t||!e.models||-1!==e.models.indexOf(t));let a=[];return s.forEach(t=>{-1===a.indexOf(t[i])&&a.push(t[i])}),a},Ijs.prototype.HelpInit=function(t,e){let i=!1;return t.forEach(t=>{e.filter(e=>e.id===t).forEach(t=>{t.ReInit()&&(i=!0)})}),i},Ijs.prototype.WatchInit=function(t){t.forEach(t=>{this.GetData({name:t,pref:""})})},Ijs.prototype.DataInit=function(t,e){let i={};t.forEach(t=>{e.filter(e=>e.id===t).forEach(t=>{const e=this.GetData({name:t.data,pref:t.path,not_null:"condition"===t.attr});i[t.id]||(i[t.id]={node:t.node,text:t.input,attr:t.attr,focus:t.focus}),i[t.id].text=i[t.id].text.replace(t.mask,e)})});for(const t in i)"textContent"===i[t].attr?(i[t].node.innerHTML="",i[t].node.innerHTML=i[t].text):"value"==i[t].attr&&"SELECT"==i[t].node.tagName?i[t].node.value=i[t].text:i[t].focus||"value"!=i[t].attr||"INPUT"!=i[t].node.tagName&&"TEXTAREA"!=i[t].node.tagName?"checked"==i[t].attr&&"INPUT"==i[t].node.tagName?i[t].node.checked=JSON.parse(i[t].text):"radio"==i[t].attr&&"INPUT"==i[t].node.tagName?i[t].node.value==i[t].text&&(i[t].node.checked=!0):i[t].node.setAttribute(i[t].attr,i[t].text):i[t].node.value=i[t].text},Ijs.prototype.ModifyPathName=function(t){const e=t.toString().trim().split(".");return"state"===e[0]||"$f"===e[0]?t.replace("state",`items.${e[1]}`).replace("$f","functions"):"watch"===e[0]||"localStorage"===e[0]?t:`items.${e[0]}.${t}`},Ijs.prototype.GetFuncData=function({model:t,params:e,pref:i}){return e?(e=GetParamsFromString(e).map(t=>"\\"==t[0]?t=t.slice(1):this.GetData({name:t,pref:i})),t(...e)):t()},Ijs.prototype.GetModels=function({pref:t,data:e}){return this.ParseKeys({pref:t,data:e,state:!0}).map(t=>"state"!=t.trim().split(".")[0]?t.trim().split(".")[0]:t.trim().split(".").length>1?t.trim().split(".")[1]:"state")},Ijs.prototype.ParseKeys=function({pref:t,data:e,log:i}){const s=this.ParseData({data:e,pref:t,state:!0});let a,n=[],o=[];if(s.params)GetParamsFromString(s.params[1]).forEach(e=>{o=[...o,...this.ParseKeys({data:e,pref:t})]});else{for(;null!=(a=this.maksKeysReg.exec(s.data));)n.push(a[1]);0===n.length&&o.push(s.data),n.forEach(e=>{o=[...o,...this.ParseKeys({data:e,pref:t,reget:!0})]})}return o},Ijs.prototype.ReKeys=function({data:t,pref:e}){let i,s;for(;null!=(i=this.maksKeysReg.exec(t));)s=i;return s&&(t=t.replace(s[0],`.${this.GetData({name:s[1],pref:e})}`)),t},Ijs.prototype.ParseData=function({pref:t,data:e,state:i},s=!1){let a,n;for(e=this.ReKeys({pref:t,data:e});null!=(n=this.maksParamsReg.exec(e));)a=n;if(a)return{data:`$f.${e.replace(a[0],s?"()":"")}`,params:a};const o=e.split(".");if("state"==o[0])return i?{data:o.slice(1).join("."),params:null}:{data:e,params:null};for(;null!=(n=this.maksParamsReg.exec(t));)a=n;return a?{data:`${t.replace(a[0],s?"()":"")}${e}`,params:a}:("state"==t.split(".")[0]&&(s=!1),{data:s?`state.${t}${e}`:`${t}${e}`,params:null})},Ijs.prototype.RePref=function({pref:t,data:e,state:i}){let s=this.ParseData({data:e,pref:t},!0);return s.params&&(s.data=s.data.replace("()",`(${GetParamsFromString(s.params[1]).map(e=>this.RePref({data:e,pref:t})).join(",")})`),i&&(s.data=`state.${s.data}`)),s.data},Ijs.prototype.GetData=function({name:t,pref:e,not_null:i}){e=e||"",i=i||!1;let{data:s,params:a}=this.ParseData({data:t,pref:e}),n=this.ModifyPathName(s).trim().split("."),o=this.models,d=e;for(var h in n){if(d=d?`${d}.${n[h]}`:n[h],0==h&&"localStorage"==n[h])return localStorage.getItem(n[1]);if("*"==n[h])return this.CleanData(o);if(isFinite(o))return parseFloat(o);if(o==n[h])return!0;if(!o[n[h]]&&0!=o[n[h]])return void 0!==o[n[h]]||i?o[n[h]]:"";"function"==typeof(o=o[n[h]])&&(d=`${d}(${a?a[1]:""})`,this.tmp[d]?o=this.tmp[d]:(o=this.GetFuncData({model:o,pref:e,params:a?a[1]:""}),this.tmp[d]=o,setTimeout(()=>{delete this.tmp[d]},100)))}return"state.$event"==t?o:i?o?"object"==typeof o?Array.isArray(o)?0!==o.length&&null!=o:0!==Object.keys(o).length:"string"==typeof o?`'${o}'`:o:null:this.CleanData(o)},Ijs.prototype.CleanData=function(t){if("object"==typeof t){if(Array.isArray(t)){let e=[];for(const i in t)"__data"!==i&&(e[i]=this.CleanData(t[i]));return e}if(null!=t){let e={};for(const i in t)"__data"!==i&&(e[i]=this.CleanData(t[i]));return e}return t}return t},Ijs.prototype.SetData=function(t,e){let i=this.models;const s=this.ModifyPathName(t).trim().split(".");for(var a in s)i[s[a]]&&a<s.length-1?i=i[s[a]]:s.length-1==a?i[s[a]]=e:(i[s[a]]={},i=i[s[a]])},Ijs.prototype.CleanKeys=function(t){this.events.filter(e=>e.parent_id==t).forEach(t=>{t.RemoveEvent()}),this.events=this.events.filter(e=>e.parent_id!==t),this.apis.objects.filter(e=>e.parent_id==t).forEach(t=>{t.active=!1,this.SetData(`$.loading.${t.id}`,!1)}),this.classes.filter(e=>e.parent_id==t).forEach(t=>{clearTimeout(t.timerId)}),this.classes=this.classes.filter(e=>e.parent_id!==t);let e=this.data.filter(e=>e.parent_id===t).map(t=>t.id);this.data=this.data.filter(e=>e.parent_id!==t);for(const t in this.keys)this.keys[t]=this.keys[t].filter(t=>-1===e.indexOf(t));e=this.helps.data.filter(e=>e.parent_id===t).map(t=>t.id),this.helps.data=this.helps.data.filter(e=>e.parent_id!==t);for(const t in this.helps.keys)this.helps.keys[t]=this.helps.keys[t].filter(t=>-1===e.indexOf(t));e=this.helps.objects.filter(e=>e.parent_id===t).map(t=>t.id),this.helps.objects=this.helps.objects.filter(e=>e.parent_id!==t);for(const t in this.helps.helpKeys)this.helps.helpKeys[t]=this.helps.helpKeys[t].filter(t=>-1===e.indexOf(t));e.forEach(t=>{this.CleanKeys(t)})},Ijs_Array.prototype.add=function(t){const e=this.items.findIndex(e=>e.id===t.id);-1===e?(this.items.push(t),t.init()):(console.error(`Duplicate api model ${t.id}`),this.update(e,t))},Ijs_Array.prototype.update=function(t){},Ijs_Object.prototype.add=function({model:t,id:e,clean:i}){const s={};s[e]=t,this.items[e]?this.items[e]=InitData(ObjectAssign(i?{}:ObjectAssign({},this.items[e]),s)):this.items[e]=InitData(s)},Ijs_Object.prototype.addFunctions=function(t){this.functions=ObjectAssign(this.functions,t)},Ijs_Object.prototype.addWatch=function(t){this.watch=ObjectAssign(this.watch,t)},Ijs_API.prototype.reConf=function(t){if("SEND"==this.action){let e;for(this.url=t.url,this.method=t.method,this.action=t.action,this.model=t.model,this.id=t.id,this.localStorage=t.localStorage,this.parent_id=t.parent_id,this.credentials=t.credentials,this.pref=t.path,this.jsonData=t.data;null!=(e=this.dataPathReg.exec(t.data));){let t=this.self.RePref({data:e[1],pref:this.pref,state:1});this.jsonData=this.jsonData.replace(e[0],t),e[1]=e[1].replace("state.",""),this.self.apis.keys[e[1]]||(this.self.apis.keys[e[1]]=[]),-1===this.self.apis.keys[e[1]].indexOf(this.id)&&this.self.apis.keys[e[1]].push(this.id)}}this.reData(t)},Ijs_API.prototype.reData=function(conf){if("SEND"!==this.action){clearTimeout(this.timerId);const _this=this;this.timerId=setTimeout(()=>{if(!_this.active)return;let modify=!1,json;if(conf&&conf.data){let t;for(this.jsonData=conf.data;null!=(t=this.dataPathReg.exec(conf.data));){let e=this.self.RePref({data:t[1],pref:this.pref,state:1});this.jsonData=this.jsonData.replace(t[0],e),t[1]=t[1].replace("state.",""),this.self.apis.keys[t[1]]||(this.self.apis.keys[t[1]]=[]),-1===this.self.apis.keys[t[1]].indexOf(this.id)&&this.self.apis.keys[t[1]].push(this.id)}}eval(`json = ${_this.jsonData};`),JSON.stringify(json)!==JSON.stringify(_this.data)&&(_this.data=json,modify=!0),conf&&conf.url&&_this.url!=conf.url?(_this.url=conf.url,modify=!0):conf&&conf.url||_this.url==_this.node.getAttribute("url")||(_this.url=_this.node.getAttribute("url"),modify=!0),modify&&"SEND"!==_this.action?(window.ijs.SetData(`$.loading.${this.id}`,!1),_this.init(conf)):window.ijs.SetData(`$.loading.${this.id}`,!0)},10)}},Ijs_API.prototype.changeData=function(t){return this.data=ObjectAssign(this.data,t),this},Ijs_API.prototype.send=function(conf){window.ijs.SetData(`$.loading.${this.id}`,!1),clearTimeout(this.sendTimerId);const _this=this;return this.sendTimerId=setTimeout(()=>{let json;eval(`json = ${_this.jsonData};`),_this.data=json,conf&&conf.url&&_this.url!=conf.url?_this.url=conf.url:conf&&conf.url||_this.url==_this.node.getAttribute("url")||(_this.url=_this.node.getAttribute("url")),_this.init(conf)},10),this},Ijs_API.prototype.init=function(t){t&&t.success?this.success_callback=t.success:this.success_callback=null,t&&t.error?this.error_callback=t.error:this.error_callback=null,aapi({url:this.url,method:this.method,data:this.data},this.onload,this.onerror,this)},Ijs_API.prototype.onload=function(t,e){e.load=!0,window.ijs.SetData(`$.loading.${e.id}`,!0);let i=null;e.model&&"*"!==e.model?i=t&&t[e.model]?t[e.model]:null:"*"===e.model&&(i=t),i&&(e.localStorage&&localStorage.setItem(e.id,JSON.stringify(i)),Ijs_API_dataInit({model:i,id:e.id})),e.success_callback&&e.success_callback(t)},Ijs_API.prototype.onerror=function(t,e,i){localStorage.removeItem(i.id),Ijs_API_dataInit({model:null,id:i.id}),i.error_callback&&i.error_callback(t,e)},IjsInputDom.prototype.Checked=function(t){const e=this;clearTimeout(this.timerId),this.timerId=setTimeout(()=>{let{data:i}=e.self.ParseData({data:e.data,pref:e.path});e.self.SetData(i,t.target.checked)},1)},IjsInputDom.prototype.Radio=function(t){const e=this;t.target.checked&&(clearTimeout(this.timerId),this.timerId=setTimeout(()=>{let{data:i}=e.self.ParseData({data:e.data,pref:e.path});e.self.SetData(i,t.target.value)},1))},IjsInputDom.prototype.Change=function(t){const e=this;clearTimeout(this.timerId),this.timerId=setTimeout(()=>{let{data:i}=e.self.ParseData({data:e.data,pref:e.path});e.self.SetData(i,t.target.value)},1)},IjsClassDom.prototype.ReClass=function(){const item=this;clearTimeout(this.timerId),this.timerId=setTimeout(()=>{let json;eval(`json = ${item.data};`);for(const t in json)json[t]?item.node.classList.add(t):item.node.classList.remove(t)},10)},IjsForDom.prototype.ReInit=function(){const t=this.self.GetData({name:this.data,pref:this.path});t&&Array.isArray(t)&&(this.node.innerHTML="",this.self.CleanKeys(this.id),t.forEach((t,e)=>{for(this.nodes.forEach(t=>{this.helpNode.append(t.cloneNode(!0))}),this.self.NodeAnalyze({node:this.helpNode,path:`${this.newPath}.${e}.`,model:this.model,pref:this.pref+this.index,index:e,three_id:this.three_id+1,parent_id:this.id});this.helpNode.children.length>0;)this.node.append(this.helpNode.children[0])}))},IjsEventDom.prototype.RemoveEvent=function(){"click"===this.nodeName?this.node.removeEventListener("click",()=>{this.DefClick()}):"hover"===this.nodeName?this.node.removeEventListener("mouseenter",()=>{this.DefClick()}):"thisclick"===this.nodeName?this.node.removeEventListener("click",t=>{this.ThisClick(t)}):"keyup"===this.nodeName?this.node.removeEventListener("keyup",t=>{this.KeyEvent(t)}):"change"===this.nodeName?this.node.removeEventListener("change",t=>{this.KeyEvent(t)}):"focusout"===this.nodeName?this.node.removeEventListener("blur",t=>{this.KeyEvent(t)}):"enter"===this.nodeName&&this.node.removeEventListener("keyup",t=>{this.EnterEvent(t)})},IjsEventDom.prototype.AddEvent=function(){"click"===this.nodeName?this.node.addEventListener("click",t=>{this.DefClick(t)}):"hover"===this.nodeName?this.node.addEventListener("mouseenter",t=>{this.DefClick(t)}):"thisclick"===this.nodeName?this.node.addEventListener("click",t=>{this.ThisClick(t)}):"keyup"===this.nodeName?this.node.addEventListener("keyup",t=>{this.KeyEvent(t)}):"change"===this.nodeName?this.node.addEventListener("change",t=>{this.KeyEvent(t)}):"focus"===this.nodeName?this.node.addEventListener("focus",t=>{this.KeyEvent(t)}):"blur"===this.nodeName?this.node.addEventListener("blur",t=>{this.KeyEvent(t)}):"focusout"===this.nodeName?this.node.addEventListener("blur",t=>{this.KeyEvent(t)}):"enter"===this.nodeName&&this.node.addEventListener("keyup",t=>{this.EnterEvent(t)})},IjsEventDom.prototype.EnterEvent=function(t){"Enter"===t.key&&(this.self.models.items.$event.$event=t,this.ClickEvent())},IjsEventDom.prototype.KeyEvent=function(t){this.self.models.items.$event.$event=t,this.ClickEvent()},IjsEventDom.prototype.DefClick=function(t){this.self.models.items.$event.$event=t,this.ClickEvent()},IjsEventDom.prototype.ThisClick=function(t){t.target==this.node&&(this.self.models.items.$event.$event=t,this.ClickEvent())},IjsEventDom.prototype.ClickEvent=function(){let t,e;this.attr.nodeValue.split(";").forEach(i=>{for(e=!1;null!=(t=this.funcReg.exec(i));)if("set"===t[1]){e=!0;let{params:t}=this.self.ParseData({data:i,pref:this.path});if(!t)return;if((t=GetParamsFromString(t[1])).length<2)return;const s=this.self.ParseData({data:t[0],pref:this.path});t[0]=s.data,"\\"==t[1][0]?(t[1]=t[1].slice(1),t[1]=IsJsonString(t[1])?JSON.parse(t[1]):t[1]):t[1]=this.self.GetData({name:t[1],pref:this.path}),this.self.SetData(...t)}else if("api"===t[1]){e=!0;let{params:t}=this.self.ParseData({data:i,pref:this.path});if(!t)return;this.self.api(t[1]).send()}e||(i=i.replace("$event","state.$event"),this.self.GetData({name:i,pref:this.path}))})},IjsPageDom.prototype.rePage=function(page){this.node.innerHTML="";const parent_id=this.id;this.self.CleanKeys(parent_id),this.helpNode.innerHTML="",page.querySelectorAll("script").forEach(script=>{script.hasAttribute("src")?(this.waiter++,jspi({url:script.getAttribute("src"),dataType:"html"}).then(answer=>{eval(answer),this.waiter--,0===this.waiter&&this.ReInit(page)})):eval(script.innerHTML)}),0===this.waiter&&this.ReInit(page)},IjsPageDom.prototype.ReInit=function(t){if(!t)return!1;for(let e=0;e<t.children.length;e++)"SCRIPT"!=t.children[e].tagName&&this.helpNode.append(t.children[e]);this.self.NodeAnalyze({node:this.helpNode,path:this.path,model:this.model,pref:this.pref+this.index,index:0,three_id:this.three_id+1,parent_id:this.id});for(let t=this.helpNode.children.length-1;t>=0;t--)this.node.prepend(this.helpNode.children[t])},IjsIfDom.prototype.ReInit=function(){const old_object=this.nodes.find(t=>t.init),object=this.nodes.find(object=>eval(object.node.getAttribute("condition")));if(object&&object.init||!old_object||(old_object.node.innerHTML="",old_object.node.style.display="none",old_object.init=!1,this.self.CleanKeys(this.id)),!object)return!1;if(object.node.style.display="block",!object.init){object.nodes.forEach(t=>{this.helpNode.append(t.cloneNode(!0))}),this.self.NodeAnalyze({node:this.helpNode,path:this.path,model:this.model,pref:this.pref+this.index,index:0,three_id:this.three_id+1,parent_id:this.id});for(let t=this.helpNode.children.length-1;t>=0;t--)object.node.prepend(this.helpNode.children[t]);return object.init=!0,!0}return!1},IjsIfDom.prototype.NextNode=function(t){const e=t.nextElementSibling;return e?"ELSEIF"!==e.tagName&&"ELSE"!==e.tagName?null:e:null},IjsIfDom.prototype.InitNode=function(t,e){let i,s=!1;const a=t.getAttribute("condition")?{nodeValue:t.getAttribute("condition"),nodeName:"condition"}:{nodeValue:"1 === 1",nodeName:"condition"};t.getAttribute("condition")||t.setAttribute("condition","1 === 1");let n=a.nodeValue;for(;null!=(i=this.textContentReg.exec(a.nodeValue));){const o=this.model?this.model:i[1].trim().split(".")[0],d=this.self.GetModels({pref:this.path,data:i[1]});let h=i[1].trim();const r={node:t,model:o,models:d,path:this.path,mask:i[0],input:i.input,data:h,attr:a.nodeName,id:`${this.id}-${a.nodeName}-${e}`,ifId:this.id,parent_id:this.parent_id};this.self.AddIfCondition(r),s=!0,n=n.replace(r.mask,this.self.GetData({name:r.data,pref:this.path,not_null:!0}))}s&&t.setAttribute(a.nodeName,n);const o={init:!1,tagName:t.tagName,node:t,nodes:[]};for(let e=0;e<t.children.length;e++)o.nodes.push(t.children[e].cloneNode(!0));return t.innerHTML="",o};